# {{ ansible_managed }}
---
version: "2.4" # v3 doesn't support group_add until Docker 1.27.0

networks:
  {{ docker_network }}:
    external: true

services:
  jellyfin:
    container_name: jellyfin
    image: jellyfin/jellyfin:latest@sha256:836232f7ffa1fdac5d043a592806422c33c68da2616f303f831e3ac25bfb6f1a
    restart: unless-stopped
    hostname: "{{ jellyfin.hostname }}"
    networks:
      - {{ docker_network }}
    # Hardware acceleration - start
    group_add:
      - "107"
    devices:
      - /dev/dri/renderD128:/dev/dri/renderD128
    # Hardware acceleration - end
    environment:
      TZ: "{{ docker_tz }}"
    volumes:
      - {{ jellyfin.datadir }}/config:/config
      - {{ jellyfin.datadir }}/cache:/cache
      - {{ jellyfin.mediadir }}:/media
    labels:
      traefik.enable: "true"
      traefik.http.routers.jellyfin.entrypoints: "https-external"
      traefik.http.routers.jellyfin.rule: "Host(`{{ jellyfin.hostname }}`)"
      traefik.http.services.jellyfin.loadbalancer.server.port: "8096"
